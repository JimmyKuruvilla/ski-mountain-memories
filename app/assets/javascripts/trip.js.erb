// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
// # You can use CoffeeScript in this file: http://coffeescript.org/

$(function() {

  function initialize() {
    var mapCanvas = document.getElementById('map-canvas');
    var lat = $('#map-canvas').data('lat'); 
    var lng = $('#map-canvas').data('lng');
    var zoom_level = $('#map-canvas').data('zoom');
    var visuals = $('#map-canvas').data('visuals');

    var mapOptions = {
      center: new google.maps.LatLng(lat, lng),
      zoom: zoom_level,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };

    var map = new google.maps.Map(mapCanvas, mapOptions);

    // setMarkers(map, visuals);

    // function setMarkers(map, locations) {

    //   var image = {
    //     url:  visual.thumbnail_url,
    //     size: new google.maps.Size(20, 32),
    //     origin: new google.maps.Point(0,0),
    //     anchor: new google.maps.Point(0, 32)
    //   };

    //   var shape = {
    //     coords: [1, 1, 1, 20, 18, 20, 18 , 1],
    //     type: 'poly'
    //   };

    //   for (var i = 0; i < locations.length; i++) {
    //     var visual = locations[i];
    //     var zindex = i + 1;
    //     var marker = new google.maps.Marker({
    //       position: new google.maps.LatLng(visual.lat, visual.lng),
    //       map: map,
    //       icon: image,
    //       shape: shape,
    //       zIndex: zindex
    //     });
    //   }

    // }

    function addMarker(visual) {
      // debugger
      var image = {
        url: visual.thumbnail_url,
        // This marker is 20 pixels wide by 32 pixels tall.
        size: new google.maps.Size(200, 200),
        // The origin for this image is 0,0.
        origin: new google.maps.Point(0,0),
        // The anchor for this image is the base of the flagpole at 0,32.
        anchor: new google.maps.Point(0, 80)
        // radius: new google.maps.Radius(100)
      };

      var shape = {
        coords: [1, 1, 1, 20, 18, 20, 18 , 1],
        type: 'poly'
      };

      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(visual.lat, visual.lng),
        icon: image,
        map: map,
        shape: shape,
        zIndex: visual.id,
        animation: google.maps.Animation.DROP
      });
    };

    for (var i = 0, visual; visual = visuals[i]; i++) {
      addMarker(visual);
    };
  }


  google.maps.event.addDomListener(window, 'load', initialize);  
})